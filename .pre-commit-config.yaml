# Pre-commit hooks configuration
# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
#
# Installation:
#   pip install pre-commit
#   pre-commit install
#
# Usage:
#   pre-commit run --all-files   # Run all hooks on all files
#   pre-commit run <hook-id>     # Run specific hook
#   pre-commit autoupdate        # Update hook versions

# Specify default Python version
default_language_version:
  python: python3.12

# Default stages for hooks (using updated stage names)
default_stages: [pre-commit, pre-push]

# Fail fast if any hook fails
fail_fast: false

# Minimum pre-commit version
minimum_pre_commit_version: '2.20.0'

# Repositories and hooks
repos:
  # ============================================================
  # General pre-commit hooks
  # ============================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      # Check for files that would conflict in case-insensitive filesystems
      - id: check-case-conflict
        name: Check for case conflicts
        stages: [pre-commit]

      # Check for files that are too large
      - id: check-added-large-files
        name: Check for large files
        args: ['--maxkb=1000']
        stages: [pre-commit]

      # Check that executables have shebangs
      - id: check-executables-have-shebangs
        name: Check executables have shebangs
        stages: [pre-commit]

      # Check that scripts with shebangs are executable
      - id: check-shebang-scripts-are-executable
        name: Check shebang scripts are executable
        stages: [pre-commit]

      # Check for symlinks that point to nothing
      - id: check-symlinks
        name: Check symlinks
        stages: [pre-commit]

      # Detect destroyed symlinks
      - id: destroyed-symlinks
        name: Detect destroyed symlinks
        stages: [pre-commit]

      # Check Python AST is valid
      - id: check-ast
        name: Check Python AST
        types: [python]
        stages: [pre-commit]

      # Prevent usage of builtin type constructors
      - id: check-builtin-literals
        name: Check builtin literals
        types: [python]
        stages: [pre-commit]

      # Check docstrings come first
      - id: check-docstring-first
        name: Check docstring first
        types: [python]
        stages: [pre-commit]

      # Detect debug statements (pdb, ipdb, etc.)
      - id: debug-statements
        name: Check for debug statements
        types: [python]
        stages: [pre-commit]

      # Detect private keys
      - id: detect-private-key
        name: Detect private keys
        stages: [pre-commit]

      # Check JSON files are valid
      - id: check-json
        name: Check JSON
        types: [json]
        stages: [pre-commit]

      # Check YAML files are valid
      - id: check-yaml
        name: Check YAML
        types: [yaml]
        # args: ['--safe']
        stages: [pre-commit]

      # Check TOML files are valid
      - id: check-toml
        name: Check TOML
        types: [toml]
        stages: [pre-commit]

      # Check XML files are valid
      - id: check-xml
        name: Check XML
        types: [xml]
        stages: [pre-commit]

      # Pretty format JSON files
      - id: pretty-format-json
        name: Pretty format JSON
        types: [json]
        args: ['--autofix', '--indent=2', '--no-sort-keys']
        stages: [pre-commit]

      # Check for merge conflict markers
      - id: check-merge-conflict
        name: Check for merge conflicts
        stages: [pre-commit]

      # Remove trailing whitespace
      - id: trailing-whitespace
        name: Trim trailing whitespace
        types: [text]
        args: [--markdown-linebreak-ext=md]
        stages: [pre-commit]

      # Ensure files end with newline
      - id: end-of-file-fixer
        name: Fix end of files
        types: [text]
        stages: [pre-commit]

      # Fix mixed line endings
      - id: mixed-line-ending
        name: Fix mixed line endings
        types: [text]
        args: ['--fix=lf']
        stages: [pre-commit]

      # Sort requirements.txt files
      - id: requirements-txt-fixer
        name: Fix requirements.txt
        types: [text]
        files: requirements.*\.txt$
        stages: [pre-commit]

  # ============================================================
  # Python code formatting with Black
  # ============================================================
  - repo: https://github.com/psf/black
    rev: 24.10.0
    hooks:
      - id: black
        name: Black code formatter
        language_version: python3.12
        types: [python]
        args:
          - --line-length=100
          - --target-version=py39
        stages: [pre-commit]


  # ============================================================
  # Python import sorting with isort
  # ============================================================
  - repo: https://github.com/PyCQA/isort
    rev: 5.13.2
    hooks:
      - id: isort
        name: isort import sorter
        types: [python]
        args:
          - --profile=black
          - --line-length=100
          - --project=nepse_client
          - --multi-line=3
          - --trailing-comma
          - --force-grid-wrap=0
          - --use-parentheses
          - --ensure-newline-before-comments
          - --lines-after-imports=2
        stages: [pre-commit]

  # ============================================================
  # Python linting with flake8
  # ============================================================
  - repo: https://github.com/PyCQA/flake8
    rev: 7.1.1
    hooks:
      - id: flake8
        name: flake8 linter
        types: [python]
        args:
          - --max-line-length=100
          - --extend-ignore=E203,W503,E501,D212,D200
          - --max-complexity=15
          - --statistics
          - --count
          - --per-file-ignores=*/__init__.py:F401,*/typing.py:F401
        additional_dependencies:
          - flake8-docstrings>=1.7.0
          - flake8-bugbear>=23.0.0
          - flake8-comprehensions>=3.14.0
          - flake8-simplify>=0.20.0
        stages: [pre-commit]

  # ============================================================
  # Python docstring checking
  # ============================================================
  - repo: https://github.com/PyCQA/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        name: pydocstyle docstring checker
        types: [python]
        args:
          - --convention=google
          - --add-ignore=D100,D104,D107,D203,D212,D213
        exclude: ^(tests/|examples/|setup.py|docs/)
        stages: [pre-commit]

  # ============================================================
  # Security checking with bandit
  # ============================================================
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10
    hooks:
      - id: bandit
        name: bandit security checker
        types: [python]
        args:
          - --recursive
          - --skip=B101,B601
        exclude: ^tests/
        stages: [pre-push]

  # ============================================================
  # Type checking with mypy
  # ============================================================
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.13.0
    hooks:
      - id: mypy
        name: mypy type checker
        types: [python]
        args:
          - --ignore-missing-imports
          - --install-types
          - --non-interactive
          - --python-version=3.11
        additional_dependencies:
          - types-requests
          - types-setuptools
        exclude: ^(tests/|examples/|setup.py|docs/)
        stages: [pre-push]

  # ============================================================
  # Upgrade Python syntax
  # ============================================================
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.19.1
    hooks:
      - id: pyupgrade
        name: pyupgrade syntax upgrader
        types: [python]
        args:
          - --py39-plus
        stages: [pre-commit]

  # ============================================================
  # YAML linting
  # ============================================================
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        name: yamllint YAML checker
        types: [yaml]
        args:
          - --strict
          - --config-data
          - "{extends: default, rules: {line-length: {max: 150}, document-start: disable, comments: {min-spaces-from-content: 1}}}"
        exclude: \.github/workflows/.*\.yml$
        stages: [pre-commit]

  # ============================================================
  # Markdown linting
  # ============================================================
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.43.0
    hooks:
      - id: markdownlint-fix
        name: markdownlint Markdown fixer
        types: [markdown]
        stages: [pre-commit]

  # ============================================================
  # Shell script checking
  # ============================================================
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.10.0.1
    hooks:
      - id: shellcheck
        name: shellcheck shell linter
        types: [shell]
        args:
          - --severity=warning
        stages: [pre-commit]

  # ============================================================
  # Jupyter notebook cleaning
  # ============================================================
  - repo: https://github.com/kynan/nbstripout
    rev: 0.8.1
    hooks:
      - id: nbstripout
        name: nbstripout notebook cleaner
        types: [jupyter]
        stages: [pre-commit]

  # ============================================================
  # Additional Python checks
  # ============================================================
  - repo: https://github.com/pre-commit/pygrep-hooks
    rev: v1.10.0
    hooks:
      - id: python-check-blanket-noqa
        name: Check for blanket noqa
        types: [python]
        stages: [pre-commit]

      - id: python-check-blanket-type-ignore
        name: Check for blanket type ignore
        types: [python]
        stages: [pre-commit]

      - id: python-no-eval
        name: Check for eval()
        types: [python]
        stages: [pre-commit]

      - id: python-no-log-warn
        name: Check for .warn() (deprecated)
        types: [python]
        stages: [pre-commit]

      - id: python-use-type-annotations
        name: Enforce type annotations
        types: [python]
        stages: [pre-commit]

      - id: rst-backticks
        name: Check RST backticks
        types: [rst]
        stages: [pre-commit]

      - id: rst-directive-colons
        name: Check RST directive colons
        types: [rst]
        stages: [pre-commit]

      - id: rst-inline-touching-normal
        name: Check RST inline code
        types: [rst]
        stages: [pre-commit]

      - id: text-unicode-replacement-char
        name: Check for unicode replacement chars
        types: [text]
        stages: [pre-commit]

  # ============================================================
  # Documentation checks
  # ============================================================
  - repo: https://github.com/rstcheck/rstcheck
    rev: v6.2.4
    hooks:
      - id: rstcheck
        name: rstcheck RST checker
        types: [rst]
        args:
          - --report-level=warning
        exclude: ^docs/
        stages: [pre-commit]

# ============================================================
# CI configuration
# ============================================================
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: [mypy, bandit]
  submodules: false
